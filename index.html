import React, { useState, useEffect } from 'react';
import { initializeApp } from "firebase/app";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  updateProfile, 
  signOut, 
  onAuthStateChanged,
  sendEmailVerification
} from "firebase/auth";
import { getFirestore, doc, setDoc, getDoc } from "firebase/firestore";
import { 
  Shield, 
  Lock, 
  Globe, 
  ChevronRight, 
  Menu, 
  X, 
  CheckCircle, 
  ArrowRight,
  Database,
  Users,
  BarChart3,
  Search,
  UserPlus,
  LogIn,
  ArrowLeft,
  MapPin,
  Phone,
  Mail,
  User,
  Flag,
  Loader2,
  AlertCircle,
  AlertTriangle,
  Send
} from 'lucide-react';

/* --- FIREBASE CONFIGURATION --- */
const firebaseConfig = {
  apiKey: "AIzaSyBXX1KptKh0ziXVAmNVAWFzvApLY8RjF8k",
  authDomain: "syncveil.firebaseapp.com",
  projectId: "syncveil",
  storageBucket: "syncveil.firebasestorage.app",
  messagingSenderId: "808362857106",
  appId: "1:808362857106:web:7edf603fc0935641db4c4b",
  measurementId: "G-ZFFXYVQY6F"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* --- MOCK DATA --- */
const BLOG_POSTS = [
  {
    id: 1,
    title: "5 Signs Your Data is Being Tracked",
    snippet: "Uncover the subtle indicators that third-party trackers are monitoring your digital footprint.",
    author: "Jonah Chawre",
    date: "Dec 8, 2025",
    category: "Privacy Tips",
    color: "bg-blue-100 text-blue-800"
  },
  {
    id: 2,
    title: "Why End-to-End Encryption Matters",
    snippet: "Encryption isn't just a buzzword. It's the mathematical shield protecting your business secrets.",
    author: "Sarah Jenks",
    date: "Dec 6, 2025",
    category: "Security",
    color: "bg-purple-100 text-purple-800"
  },
  {
    id: 3,
    title: "The SyncVeil Guide to Stronger Passwords",
    snippet: "Stop using 'password123'. Here is a memorable, entropy-based method for secure credentials.",
    author: "Jonah Chawre",
    date: "Dec 1, 2025",
    category: "Guides",
    color: "bg-teal-100 text-teal-800"
  }
];

const FEATURES = [
  {
    title: "Real-time Monitoring",
    desc: "Watch your data flows in real-time with our visual dashboard. Spot anomalies before they become breaches.",
    icon: <BarChart3 className="w-6 h-6 text-indigo-600" />,
    bg: "bg-indigo-50"
  },
  {
    title: "GDPR Compliance",
    desc: "Automated auditing tools that ensure you meet global privacy standards without the paperwork headache.",
    icon: <Globe className="w-6 h-6 text-teal-600" />,
    bg: "bg-teal-50"
  },
  {
    title: "Secure Cloud Vault",
    desc: "Military-grade encryption for your most sensitive documents. Only you hold the decryption keys.",
    icon: <Lock className="w-6 h-6 text-rose-600" />,
    bg: "bg-rose-50"
  }
];

// Content for Footer Pages
const PAGE_CONTENT = {
  "default": { title: "Page Not Found", content: "The requested content is not available." },
  "Features": { title: "Product Features", content: "Explore our comprehensive suite of privacy tools designed for the modern web. From real-time monitoring to automated compliance checks, SyncVeil provides the infrastructure you need to secure your data." },
  "Security": { title: "Security Protocols", content: "Our security architecture is built on zero-trust principles. We utilize AES-256 encryption for data at rest and TLS 1.3 for data in transit. We regularly undergo third-party audits to ensure our defenses are impenetrable." },
  "Roadmap": { title: "Product Roadmap", content: "We are constantly innovating. Upcoming features include AI-driven threat detection, deeper integration with cloud providers like AWS and Azure, and a mobile app for on-the-go security management." },
  "Pricing": { title: "Pricing Plans", content: "Flexible pricing for teams of all sizes. Start with our free tier for basic protection, or upgrade to Enterprise for unlimited data retention, dedicated support, and advanced compliance reporting." },
  "About": { title: "About SyncVeil", content: "Founded in 2024, SyncVeil was born from a simple idea: Privacy shouldn't be complicated. We are a diverse team of security engineers, designers, and data advocates working to make the internet safer for everyone." },
  "Careers": { title: "Join Our Team", content: "We are looking for passionate individuals to join our mission. If you love solving complex problems and care deeply about digital rights, check out our open positions in Engineering, Design, and Sales." },
  "Blog": { title: "SyncVeil Blog", content: "Read our latest thoughts on industry trends, security best practices, and product updates. We publish weekly articles to help you stay informed in the rapidly evolving landscape of cybersecurity." },
  "Contact": { title: "Contact Us", content: "Need help? Our support team is available 24/7. Reach out to us at support@syncveil.com or visit our headquarters in San Francisco." },
  "Privacy Policy": { title: "Privacy Policy", content: "Your privacy is our priority. We do not sell your data. We only collect the minimum information necessary to provide our services. Read the full legal text to understand your rights and our obligations." },
  "Terms of Service": { title: "Terms of Service", content: "By using SyncVeil, you agree to these terms. They govern your access to and use of our services. Please read them carefully to understand the rules of the road." },
  "Cookie Policy": { title: "Cookie Policy", content: "We use cookies to enhance your experience. This policy explains what cookies are, how we use them, and how you can manage your preferences." }
};

/* --- COMPONENTS --- */

const Navbar = ({ isScrolled, navigate, user, handleLogout }) => {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <nav className={`fixed w-full z-50 transition-all duration-300 ${isScrolled ? 'bg-white/90 backdrop-blur-md shadow-sm py-4' : 'bg-transparent py-6'}`}>
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
        {/* Logo - Black and White */}
        <div className="flex items-center gap-2 cursor-pointer group" onClick={() => navigate('home')}>
          <div className="w-10 h-10 bg-black rounded-xl flex items-center justify-center shadow-lg group-hover:shadow-slate-500/30 transition-all duration-300">
            <Shield className="w-6 h-6 text-white" />
          </div>
          <span className={`text-2xl font-bold tracking-tight ${isScrolled ? 'text-slate-800' : 'text-slate-800'} transition-colors`}>
            Sync<span className="text-black">Veil</span>
          </span>
        </div>

        {/* Desktop Links */}
        <div className="hidden md:flex items-center gap-8">
          {['Product', 'Solutions', 'Resources', 'Pricing'].map((item) => (
            <button key={item} onClick={() => navigate('content', item)} className="text-slate-600 hover:text-indigo-600 font-medium transition-colors">
              {item}
            </button>
          ))}
          
          {user ? (
             <div className="flex items-center gap-4">
                <span className="text-sm font-semibold text-slate-700">Hi, {user.displayName || 'User'}</span>
                <button 
                  onClick={handleLogout}
                  className="bg-slate-200 text-slate-800 px-5 py-2 rounded-full font-medium hover:bg-slate-300 transition-all"
                >
                  Log Out
                </button>
             </div>
          ) : (
            <button 
              onClick={() => navigate('auth')}
              className="bg-slate-900 text-white px-6 py-2.5 rounded-full font-medium hover:bg-indigo-600 hover:shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 transform hover:-translate-y-0.5"
            >
              Get Started
            </button>
          )}
        </div>

        {/* Mobile Menu Button */}
        <button onClick={() => setIsOpen(!isOpen)} className="md:hidden text-slate-700 p-2">
          {isOpen ? <X /> : <Menu />}
        </button>
      </div>

      {/* Mobile Menu */}
      {isOpen && (
        <div className="md:hidden absolute top-full left-0 w-full bg-white shadow-xl border-t border-slate-100 p-4 flex flex-col gap-4 animate-fade-in">
          {['Product', 'Solutions', 'Resources', 'Pricing'].map((item) => (
            <button key={item} onClick={() => { navigate('content', item); setIsOpen(false); }} className="text-left text-slate-600 hover:text-indigo-600 font-medium py-2">
              {item}
            </button>
          ))}
          {user ? (
            <button 
              onClick={() => { handleLogout(); setIsOpen(false); }}
              className="bg-slate-200 text-slate-800 w-full py-3 rounded-lg font-medium"
            >
              Log Out
            </button>
          ) : (
            <button 
              onClick={() => { navigate('auth'); setIsOpen(false); }}
              className="bg-indigo-600 text-white w-full py-3 rounded-lg font-medium"
            >
              Get Started
            </button>
          )}
        </div>
      )}
    </nav>
  );
};

const Hero = ({ navigate, user }) => {
  const [verificationSent, setVerificationSent] = useState(false);

  const resendVerification = async () => {
    if (user && !user.emailVerified) {
      try {
        await sendEmailVerification(user);
        setVerificationSent(true);
        setTimeout(() => setVerificationSent(false), 5000);
      } catch (error) {
        console.error("Error sending verification", error);
      }
    }
  };

  return (
    <div className="relative pt-32 pb-20 lg:pt-48 lg:pb-32 overflow-hidden">
      {/* Abstract Background Shapes */}
      <div className="absolute top-0 right-0 -z-10 w-1/2 h-full bg-gradient-to-bl from-indigo-50 via-teal-50 to-white opacity-60 rounded-bl-[100px]"></div>
      <div className="absolute bottom-0 left-0 -z-10 w-96 h-96 bg-rose-50 rounded-full blur-3xl opacity-50 translate-y-1/2 -translate-x-1/4"></div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        {/* Verification Banner */}
        {user && !user.emailVerified && (
          <div className="mb-8 p-4 bg-yellow-50 border border-yellow-200 rounded-xl flex flex-col md:flex-row items-center justify-between gap-4 animate-fade-in-up">
            <div className="flex items-center gap-3">
              <AlertTriangle className="w-5 h-5 text-yellow-600" />
              <div>
                <p className="font-bold text-yellow-800 text-sm">Please verify your email address</p>
                <p className="text-yellow-700 text-xs">We sent a link to {user.email}</p>
              </div>
            </div>
            <button 
              onClick={resendVerification}
              disabled={verificationSent}
              className="text-xs font-bold bg-white border border-yellow-200 px-4 py-2 rounded-lg text-yellow-700 hover:bg-yellow-100 transition-colors"
            >
              {verificationSent ? "Email Sent!" : "Resend Email"}
            </button>
          </div>
        )}

        <div className="grid lg:grid-cols-2 gap-12 items-center">
          {/* Text Content */}
          <div className="space-y-8 animate-fade-in-up">
            <div className="inline-flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-full shadow-sm text-sm font-semibold text-slate-700">
              <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
              v2.0 is live: Enhanced Encryption
            </div>
            
            <h1 className="text-5xl lg:text-7xl font-extrabold text-slate-900 leading-[1.1]">
              Privacy that <br />
              <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-teal-500">
                Empowers.
              </span>
            </h1>
            
            <p className="text-lg text-slate-600 max-w-lg leading-relaxed">
              SyncVeil gives you complete control over your digital footprint. Monitor, manage, and secure your startup's data without compromising speed.
            </p>

            <div className="flex flex-col sm:flex-row gap-4">
              <button 
                onClick={() => navigate('auth')}
                className="px-8 py-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2"
              >
                {user ? "Go to Dashboard" : "Get Started"} <ArrowRight className="w-5 h-5" />
              </button>
              <button className="px-8 py-4 bg-white text-slate-700 border border-slate-200 rounded-xl font-bold hover:border-indigo-200 hover:bg-indigo-50 transition-all duration-300 flex items-center justify-center gap-2">
                <Search className="w-5 h-5" /> View Demo
              </button>
            </div>
          </div>

          {/* Graphical/UI Illustration */}
          <div className="relative animate-fade-in-right hidden lg:block">
            {/* Main Card */}
            <div className="relative z-10 bg-white rounded-3xl shadow-2xl border border-slate-100 p-6 transform rotate-[-2deg] hover:rotate-0 transition-all duration-500">
              <div className="flex items-center justify-between mb-8">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center">
                    <Database className="w-6 h-6 text-indigo-600" />
                  </div>
                  <div>
                    <h3 className="font-bold text-slate-900">Data Vault</h3>
                    <p className="text-xs text-slate-500">Status: Secured</p>
                  </div>
                </div>
                <div className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-bold">Active</div>
              </div>
              
              <div className="space-y-4">
                <div className="h-32 bg-slate-50 rounded-2xl border border-slate-100 relative overflow-hidden group">
                   <div className="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-indigo-100 to-transparent opacity-50"></div>
                   <div className="absolute bottom-0 left-0 right-0 flex items-end justify-between px-4 pb-2 h-full">
                      {[40, 70, 45, 90, 60, 80, 50].map((h, i) => (
                        <div key={i} style={{ height: `${h}%` }} className="w-2 bg-indigo-500 rounded-t-sm group-hover:bg-indigo-600 transition-colors"></div>
                      ))}
                   </div>
                </div>
                <div className="flex justify-between items-center pt-2">
                  <div className="space-y-1">
                    <div className="h-2 w-24 bg-slate-200 rounded-full"></div>
                    <div className="h-2 w-16 bg-slate-100 rounded-full"></div>
                  </div>
                  <div className="h-8 w-20 bg-slate-900 rounded-lg"></div>
                </div>
              </div>
            </div>

            {/* Floating Element 1 */}
            <div className="absolute -top-12 -right-12 z-0 bg-white p-4 rounded-2xl shadow-xl border border-slate-100 animate-float">
               <div className="flex items-center gap-3">
                 <div className="p-2 bg-rose-100 rounded-lg"><Shield className="w-5 h-5 text-rose-600" /></div>
                 <div>
                   <p className="text-xs font-bold text-slate-800">Threat Blocked</p>
                   <p className="text-[10px] text-slate-400">Just now</p>
                 </div>
               </div>
            </div>

            {/* Floating Element 2 */}
            <div className="absolute -bottom-8 -left-8 z-20 bg-white p-4 rounded-2xl shadow-xl border border-slate-100 animate-float-delayed">
               <div className="flex items-center gap-3">
                 <div className="p-2 bg-teal-100 rounded-lg"><CheckCircle className="w-5 h-5 text-teal-600" /></div>
                 <div>
                   <p className="text-xs font-bold text-slate-800">System Optimal</p>
                   <p className="text-[10px] text-slate-400">99.9% Uptime</p>
                 </div>
               </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

/* --- Helper Component: Input Group --- */
const InputGroup = ({ label, name, type = "text", placeholder, value, onChange, icon: Icon, required = false }) => (
  <div className="space-y-1">
    <label className="text-sm font-bold text-slate-700">{label} {required && <span className="text-red-500">*</span>}</label>
    <div className="relative">
      <input 
        name={name}
        type={type} 
        placeholder={placeholder}
        value={value}
        onChange={onChange}
        required={required}
        className="w-full bg-slate-50 border border-slate-200 rounded-xl pl-11 pr-4 py-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all text-slate-800 font-medium" 
      />
      {Icon && <Icon className="w-5 h-5 text-slate-400 absolute left-3 top-3.5" />}
    </div>
  </div>
);

/* --- UPDATED AUTH PAGE WITH EMAIL VERIFICATION --- */
const AuthPage = ({ navigate }) => {
  const [authMode, setAuthMode] = useState('select'); 
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState('');
  
  // State for Form Fields
  const [formData, setFormData] = useState({
    email: '',
    password: '',
    fullName: '',
    mobile: '',
    address: '',
    city: '',
    country: '',
    gender: 'Male'
  });

  const handleInputChange = (e) => {
    const { name, value, type } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'radio' ? (e.target.checked ? value : prev[name]) : value
    }));
    setError(''); // Clear error on typing
  };

  const handleLogin = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');
    
    // SAFETY TIMEOUT
    const timer = setTimeout(() => {
      setIsLoading(false);
      setError("Request timed out. Please check your network or if your domain is allowed in Firebase Console.");
    }, 10000);
    
    try {
      await signInWithEmailAndPassword(auth, formData.email, formData.password);
      clearTimeout(timer);
      navigate('home');
    } catch (err) {
      clearTimeout(timer);
      console.error("Firebase Auth Error:", err);
      let msg = "Failed to log in.";
      if (err.code === 'auth/invalid-credential') msg = "Invalid email or password.";
      else if (err.code === 'auth/user-not-found') msg = "No account found with this email.";
      else if (err.code === 'auth/wrong-password') msg = "Incorrect password.";
      else if (err.code === 'auth/operation-not-allowed') msg = "Email/Password login is not enabled in Firebase Console.";
      else if (err.code === 'auth/unauthorized-domain') msg = "This domain is not authorized in Firebase Console.";
      setError(msg);
    } finally {
      setIsLoading(false);
    }
  };

  const handleSignup = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');

    // Basic Validation
    if (!formData.fullName || !formData.email || !formData.password || !formData.mobile) {
      setError("Please fill in all required fields.");
      setIsLoading(false);
      return;
    }

    const timer = setTimeout(() => {
      setIsLoading(false);
      setError("Request timed out. Please check your network or if your domain is allowed in Firebase Console.");
    }, 10000);

    try {
      // 1. Create User
      const userCredential = await createUserWithEmailAndPassword(auth, formData.email, formData.password);
      const user = userCredential.user;
      clearTimeout(timer);

      // 2. Update Profile
      await updateProfile(user, { displayName: formData.fullName });

      // 3. SEND EMAIL VERIFICATION (New Feature)
      await sendEmailVerification(user);

      // 4. Store Data
      await setDoc(doc(db, "users", user.uid), {
        fullName: formData.fullName,
        email: formData.email,
        mobile: formData.mobile,
        address: formData.address,
        city: formData.city,
        country: formData.country,
        gender: formData.gender,
        createdAt: new Date().toISOString(),
        emailVerified: false
      });

      // Redirect
      navigate('home');
    } catch (err) {
      clearTimeout(timer);
      console.error("Firebase Signup Error:", err);
      let msg = "Failed to create account.";
      if (err.code === 'auth/email-already-in-use') msg = "This email is already in use.";
      else if (err.code === 'auth/weak-password') msg = "Password should be at least 6 characters.";
      setError(msg);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen pt-28 pb-20 flex items-center justify-center relative overflow-hidden bg-slate-50/50">
      <div className="absolute top-0 right-0 -z-10 w-1/2 h-full bg-gradient-to-bl from-indigo-50 via-teal-50 to-white opacity-60 rounded-bl-[100px]"></div>
      <div className="absolute bottom-0 left-0 -z-10 w-96 h-96 bg-rose-50 rounded-full blur-3xl opacity-50 translate-y-1/2 -translate-x-1/4"></div>

      <div className="max-w-5xl w-full mx-4 animate-fade-in-up">
        <button onClick={() => {
            setError('');
            if (authMode === 'select') navigate('home');
            else setAuthMode('select');
          }} 
          className="mb-8 flex items-center text-slate-600 hover:text-indigo-600 font-medium transition-colors"
        >
          <ArrowLeft className="w-5 h-5 mr-2" /> 
          {authMode === 'select' ? 'Back to Home' : 'Back to Selection'}
        </button>

        {authMode === 'select' && (
          <div className="bg-white rounded-3xl shadow-2xl border border-slate-100 overflow-hidden">
            <div className="grid md:grid-cols-2">
              <div 
                onClick={() => setAuthMode('signup')}
                className="p-12 border-b md:border-b-0 md:border-r border-slate-100 hover:bg-indigo-50/30 transition-colors group cursor-pointer"
              >
                <div className="w-16 h-16 bg-indigo-100 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                  <UserPlus className="w-8 h-8 text-indigo-600" />
                </div>
                <h2 className="text-3xl font-bold text-slate-900 mb-4">New here?</h2>
                <p className="text-slate-600 mb-8 leading-relaxed">
                  Join thousands of teams securing their data. Create an account to start your free 14-day trial.
                </p>
                <button className="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                  Create Account <ArrowRight className="w-5 h-5" />
                </button>
              </div>

              <div 
                onClick={() => setAuthMode('login')}
                className="p-12 hover:bg-teal-50/30 transition-colors group cursor-pointer"
              >
                <div className="w-16 h-16 bg-teal-100 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform">
                  <LogIn className="w-8 h-8 text-teal-600" />
                </div>
                <h2 className="text-3xl font-bold text-slate-900 mb-4">Welcome back</h2>
                <p className="text-slate-600 mb-8 leading-relaxed">
                  Already have a SyncVeil account? Log in to access your dashboard and security insights.
                </p>
                <button className="w-full py-4 bg-white text-slate-800 border-2 border-slate-200 rounded-xl font-bold hover:border-teal-400 hover:text-teal-700 transition-all flex items-center justify-center gap-2">
                  Log In <ChevronRight className="w-5 h-5" />
                </button>
              </div>
            </div>
          </div>
        )}

        {authMode === 'login' && (
          <div className="max-w-md mx-auto bg-white rounded-3xl shadow-2xl border border-slate-100 p-8 md:p-12">
             <div className="text-center mb-8">
               <div className="w-12 h-12 bg-teal-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                 <LogIn className="w-6 h-6 text-teal-600" />
               </div>
               <h2 className="text-3xl font-bold text-slate-900">Welcome Back</h2>
               <p className="text-slate-500 mt-2">Enter your credentials to access your vault.</p>
             </div>

             {error && (
               <div className="mb-6 p-4 bg-red-50 text-red-600 rounded-xl flex items-center text-sm font-medium border border-red-100">
                 <AlertCircle className="w-5 h-5 mr-2" /> {error}
               </div>
             )}

             <form onSubmit={handleLogin} className="space-y-6">
               <InputGroup 
                 label="Email Address" 
                 name="email" 
                 type="email" 
                 placeholder="you@company.com" 
                 icon={Mail} 
                 required 
                 value={formData.email}
                 onChange={handleInputChange}
               />
               <InputGroup 
                 label="Password" 
                 name="password" 
                 type="password" 
                 placeholder="••••••••" 
                 icon={Lock} 
                 required 
                 value={formData.password}
                 onChange={handleInputChange}
               />
               
               <div className="flex justify-between items-center text-sm">
                 <label className="flex items-center text-slate-600 cursor-pointer">
                   <input type="checkbox" className="mr-2 rounded text-indigo-600 focus:ring-indigo-500" />
                   Remember me
                 </label>
                 <a href="#" className="text-indigo-600 font-bold hover:underline">Forgot password?</a>
               </div>

               <button disabled={isLoading} className="w-full py-4 bg-slate-900 text-white rounded-xl font-bold hover:bg-indigo-600 shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 flex items-center justify-center disabled:opacity-70 disabled:cursor-not-allowed">
                 {isLoading ? <Loader2 className="w-5 h-5 animate-spin" /> : 'Log In'}
               </button>
             </form>
             
             <p className="text-center mt-8 text-slate-600">
               Don't have an account? <button onClick={() => setAuthMode('signup')} className="text-indigo-600 font-bold hover:underline">Sign up</button>
             </p>
          </div>
        )}

        {authMode === 'signup' && (
          <div className="bg-white rounded-3xl shadow-2xl border border-slate-100 p-8 md:p-12">
            <div className="text-center mb-10">
               <div className="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center mx-auto mb-4">
                 <UserPlus className="w-6 h-6 text-indigo-600" />
               </div>
               <h2 className="text-3xl font-bold text-slate-900">Create your Account</h2>
               <p className="text-slate-500 mt-2">Start your 14-day free trial. No credit card required.</p>
            </div>

            {error && (
               <div className="mb-6 p-4 bg-red-50 text-red-600 rounded-xl flex items-center text-sm font-medium border border-red-100">
                 <AlertCircle className="w-5 h-5 mr-2" /> {error}
               </div>
             )}

            <form onSubmit={handleSignup}>
              <div className="grid md:grid-cols-2 gap-6 mb-8">
                {/* Personal Info */}
                <div className="md:col-span-2">
                  <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Personal Information</h3>
                </div>
                
                <InputGroup 
                  label="Full Name" 
                  name="fullName" 
                  placeholder="e.g. Jonah Chawre" 
                  icon={User} 
                  required 
                  value={formData.fullName}
                  onChange={handleInputChange}
                />
                <InputGroup 
                  label="Mobile Number" 
                  name="mobile" 
                  type="tel" 
                  placeholder="+1 (555) 000-0000" 
                  icon={Phone} 
                  required 
                  value={formData.mobile}
                  onChange={handleInputChange}
                />
                <InputGroup 
                  label="Email Address" 
                  name="email" 
                  type="email" 
                  placeholder="you@company.com" 
                  icon={Mail} 
                  required 
                  value={formData.email}
                  onChange={handleInputChange}
                />
                
                <div className="space-y-1">
                  <label className="text-sm font-bold text-slate-700">Gender</label>
                  <div className="flex gap-4 pt-3">
                    {['Male', 'Female', 'Other'].map(g => (
                      <label key={g} className="flex items-center cursor-pointer">
                        <input 
                          type="radio" 
                          name="gender" 
                          value={g}
                          checked={formData.gender === g}
                          onChange={handleInputChange}
                          className="mr-2 text-indigo-600 focus:ring-indigo-500" 
                        />
                        <span className="text-slate-700 font-medium">{g}</span>
                      </label>
                    ))}
                  </div>
                </div>

                {/* Location Info */}
                <div className="md:col-span-2 mt-2">
                  <h3 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Location Details</h3>
                </div>

                <InputGroup 
                  label="Address" 
                  name="address" 
                  placeholder="123 Privacy Lane" 
                  icon={MapPin} 
                  value={formData.address}
                  onChange={handleInputChange}
                />
                <InputGroup 
                  label="City" 
                  name="city" 
                  placeholder="San Francisco" 
                  icon={MapPin} 
                  value={formData.city}
                  onChange={handleInputChange}
                />
                <InputGroup 
                  label="Country" 
                  name="country" 
                  placeholder="United States" 
                  icon={Flag} 
                  value={formData.country}
                  onChange={handleInputChange}
                />
                
                {/* Password - Needed for account creation */}
                <div className="md:col-span-2 mt-2">
                   <InputGroup 
                     label="Create Password" 
                     name="password" 
                     type="password" 
                     placeholder="Create a strong password" 
                     icon={Lock} 
                     required 
                     value={formData.password}
                     onChange={handleInputChange}
                   />
                </div>
              </div>

              <div className="flex items-start gap-3 mb-8">
                <input type="checkbox" className="mt-1 rounded text-indigo-600 focus:ring-indigo-500" required />
                <p className="text-sm text-slate-600">
                  I agree to the <span className="text-indigo-600 font-bold cursor-pointer">Terms of Service</span> and <span className="text-indigo-600 font-bold cursor-pointer">Privacy Policy</span>.
                </p>
              </div>

              <button disabled={isLoading} className="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed">
                {isLoading ? <Loader2 className="w-5 h-5 animate-spin" /> : 'Create Account'}
              </button>
            </form>

            <p className="text-center mt-8 text-slate-600">
               Already have an account? <button onClick={() => setAuthMode('login')} className="text-indigo-600 font-bold hover:underline">Log in</button>
            </p>
          </div>
        )}
      </div>
    </div>
  );
};

const ContentPage = ({ navigate, title, content }) => {
  return (
    <div className="min-h-screen pt-32 pb-20 relative overflow-hidden">
      {/* Background Shapes */}
      <div className="absolute top-0 right-0 -z-10 w-1/2 h-full bg-gradient-to-bl from-slate-50 via-indigo-50 to-white opacity-60 rounded-bl-[100px]"></div>

      <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in-up">
        <button onClick={() => navigate('home')} className="mb-8 flex items-center text-slate-600 hover:text-indigo-600 font-medium transition-colors">
          <ArrowLeft className="w-5 h-5 mr-2" /> Back to Home
        </button>

        <div className="bg-white rounded-3xl shadow-xl border border-slate-100 p-8 md:p-12">
          <h1 className="text-4xl md:text-5xl font-extrabold text-slate-900 mb-8">{title}</h1>
          <div className="w-20 h-2 bg-gradient-to-r from-indigo-500 to-teal-400 rounded-full mb-8"></div>
          <div className="prose prose-lg text-slate-600 leading-loose">
            <p className="text-xl font-light text-slate-800 mb-8">
              {content}
            </p>
            {/* Generated filler content to make it look like a "long description" page */}
            <p className="mb-6">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.
            </p>
            <p className="mb-6">
              Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.
            </p>
            <h3 className="text-2xl font-bold text-slate-900 mt-8 mb-4">Why this matters</h3>
            <p className="mb-6">
              Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.
            </p>
          </div>
        </div>
      </div>
    </div>
  );
};

const FeatureSection = ({ navigate }) => {
  return (
    <section id="solutions" className="py-24 bg-white relative">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="text-center mb-16 max-w-3xl mx-auto">
          <h2 className="text-sm font-bold text-indigo-600 tracking-wider uppercase mb-2">Features</h2>
          <h3 className="text-3xl md:text-4xl font-extrabold text-slate-900 mb-4">Everything you need to protect your privacy.</h3>
          <p className="text-slate-600 text-lg">We've simplified complex security protocols into an elegant interface that anyone can use.</p>
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          {FEATURES.map((feature, idx) => (
            <div key={idx} onClick={() => navigate('content', feature.title)} className="group p-8 rounded-3xl bg-white border border-slate-100 hover:border-indigo-100 hover:shadow-2xl hover:shadow-indigo-900/5 transition-all duration-500 cursor-pointer">
              <div className={`w-14 h-14 rounded-2xl ${feature.bg} flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300`}>
                {feature.icon}
              </div>
              <h4 className="text-xl font-bold text-slate-900 mb-3">{feature.title}</h4>
              <p className="text-slate-600 leading-relaxed mb-6">
                {feature.desc}
              </p>
              <div className="flex items-center text-indigo-600 font-bold text-sm group-hover:translate-x-2 transition-transform">
                Learn more <ChevronRight className="w-4 h-4 ml-1" />
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

const BlogSection = ({ navigate }) => {
  return (
    <section id="resources" className="py-24 bg-slate-50">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex flex-col md:flex-row md:items-end justify-between mb-12 gap-4">
          <div>
            <h2 className="text-3xl md:text-4xl font-extrabold text-slate-900 mb-4">Latest Insights</h2>
            <p className="text-slate-600 max-w-xl">
              Stay ahead of the curve with expert articles on privacy, security, and digital wellbeing.
            </p>
          </div>
          <button onClick={() => navigate('content', 'Blog')} className="text-indigo-600 font-bold flex items-center hover:underline">
            View all articles <ArrowRight className="w-5 h-5 ml-2" />
          </button>
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          {BLOG_POSTS.map((post) => (
            <div key={post.id} onClick={() => navigate('content', post.title)} className="bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 border border-slate-100 flex flex-col h-full cursor-pointer">
              {/* Thumbnail Placeholder */}
              <div className="h-48 bg-slate-200 relative overflow-hidden">
                 <div className="absolute inset-0 bg-gradient-to-tr from-slate-200 to-slate-100"></div>
                 {/* Decorative geometric shapes for thumbnails */}
                 <div className={`absolute -bottom-10 -right-10 w-40 h-40 rounded-full opacity-20 ${post.id === 1 ? 'bg-blue-500' : post.id === 2 ? 'bg-purple-500' : 'bg-teal-500'}`}></div>
              </div>
              
              <div className="p-6 flex-1 flex flex-col">
                <div className="flex justify-between items-center mb-4">
                  <span className={`px-3 py-1 rounded-full text-xs font-bold ${post.color}`}>
                    {post.category}
                  </span>
                  <span className="text-slate-400 text-xs font-medium">{post.date}</span>
                </div>
                
                <h3 className="text-xl font-bold text-slate-900 mb-3 hover:text-indigo-600 transition-colors">
                  {post.title}
                </h3>
                
                <p className="text-slate-600 text-sm mb-6 flex-1">
                  {post.snippet}
                </p>
                
                <div className="flex items-center gap-3 pt-4 border-t border-slate-50">
                  <div className="w-8 h-8 rounded-full bg-slate-900 flex items-center justify-center text-white text-xs font-bold">
                    {post.author.charAt(0)}
                  </div>
                  <span className="text-sm font-medium text-slate-700">{post.author}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

const Footer = ({ navigate }) => {
  return (
    <footer className="bg-slate-900 text-white py-16">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="grid md:grid-cols-4 gap-12 mb-12">
          <div className="col-span-1 md:col-span-1">
            <div className="flex items-center gap-2 mb-6 cursor-pointer" onClick={() => navigate('home')}>
              <div className="w-8 h-8 bg-black border border-slate-700 rounded-lg flex items-center justify-center">
                <Shield className="w-5 h-5 text-white" />
              </div>
              <span className="text-xl font-bold">SyncVeil</span>
            </div>
            <p className="text-slate-400 text-sm leading-relaxed">
              Empowering users to take control of their digital lives through transparent, accessible privacy tools.
            </p>
          </div>
          
          {[
            { header: "Product", links: ["Features", "Security", "Roadmap", "Pricing"] },
            { header: "Company", links: ["About", "Careers", "Blog", "Contact"] },
            { header: "Legal", links: ["Privacy Policy", "Terms of Service", "Cookie Policy"] }
          ].map((col, idx) => (
            <div key={idx}>
              <h4 className="font-bold mb-4">{col.header}</h4>
              <ul className="space-y-3">
                {col.links.map(link => (
                  <li key={link}>
                    <button 
                      onClick={() => navigate('content', link)}
                      className="text-slate-400 hover:text-white text-sm transition-colors text-left"
                    >
                      {link}
                    </button>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
        
        <div className="border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
          <p className="text-slate-500 text-sm">© 2025 SyncVeil Inc. All rights reserved.</p>
          <div className="flex gap-6">
            <span className="text-slate-500 text-sm hover:text-white cursor-pointer">Twitter</span>
            <span className="text-slate-500 text-sm hover:text-white cursor-pointer">LinkedIn</span>
            <span className="text-slate-500 text-sm hover:text-white cursor-pointer">GitHub</span>
          </div>
        </div>
      </div>
    </footer>
  );
};

/* --- MAIN APP --- */
export default function App() {
  const [isScrolled, setIsScrolled] = useState(false);
  const [currentView, setCurrentView] = useState('home'); // 'home', 'auth', 'content'
  const [selectedContent, setSelectedContent] = useState(null);
  const [user, setUser] = useState(null);

  // Router function
  const navigate = (view, contentKey = null) => {
    window.scrollTo(0, 0);
    setCurrentView(view);
    if (contentKey) {
      setSelectedContent(PAGE_CONTENT[contentKey] || { title: contentKey, content: "Detailed information coming soon." });
    }
  };

  useEffect(() => {
    const handleScroll = () => {
      setIsScrolled(window.scrollY > 20);
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  // Listen to Auth State Changes
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
      setUser(currentUser);
    });
    return () => unsubscribe();
  }, []);

  const handleLogout = async () => {
    try {
      await signOut(auth);
      navigate('home');
    } catch (error) {
      console.error("Logout Error:", error);
    }
  };

  return (
    <div className="font-sans antialiased bg-white text-slate-900 selection:bg-indigo-100 selection:text-indigo-900">
      <Navbar isScrolled={isScrolled} navigate={navigate} user={user} handleLogout={handleLogout} />
      
      {currentView === 'home' && (
        <>
          <Hero navigate={navigate} user={user} />
          <FeatureSection navigate={navigate} />
          <BlogSection navigate={navigate} />
        </>
      )}

      {currentView === 'auth' && (
        <AuthPage navigate={navigate} />
      )}

      {currentView === 'content' && selectedContent && (
        <ContentPage 
          navigate={navigate} 
          title={selectedContent.title} 
          content={selectedContent.content} 
        />
      )}

      <Footer navigate={navigate} />
      
      {/* Custom Keyframe Animations */}
      <style>{`
        @keyframes float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        @keyframes float-delayed {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }
        .animate-float {
          animation: float 6s ease-in-out infinite;
        }
        .animate-float-delayed {
          animation: float-delayed 7s ease-in-out infinite 2s;
        }
        .animate-fade-in-up {
          animation: fadeInUp 0.8s ease-out forwards;
        }
        .animate-fade-in-right {
          animation: fadeInRight 0.8s ease-out forwards;
        }
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInRight {
          from { opacity: 0; transform: translateX(20px); }
          to { opacity: 1; transform: translateX(0); }
        }
      `}</style>
    </div>
  );
}
